(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-571a9732"],{"0ad7":function(e,t,r){"use strict";r.d(t,"g",(function(){return o})),r.d(t,"e",(function(){return n})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"f",(function(){return l})),r.d(t,"h",(function(){return d})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return h}));var a=r("66df"),s=r("4360");const o=()=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/getprojects",method:"get"}),n=e=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/getallconfig/"+e,method:"get"}),i=e=>{let t=s["a"].state.confcenter.basePath+"/api/addconfig/"+e.proj;return e.editable&&(t=s["a"].state.confcenter.basePath+"/api/updateconfig/"+e.proj),a["a"].request({url:t,data:e,method:"post"})},c=e=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/addproject/"+e,method:"get"}),l=e=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/getpermission/"+e,method:"get"}),d=e=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/updatepermission/"+e.proj,data:e,method:"post"}),p=e=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/delconfig/"+e.proj+"/"+e.name,data:e,method:"delete"}),h=e=>a["a"].request({url:s["a"].state.confcenter.basePath+"/api/delproj/"+e.proj,data:e,method:"delete"})},dd02:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("Row",[r("Col",{attrs:{span:"24"}},[r("Card",{},[r("Button",{staticStyle:{"margin-bottom":"2px"},attrs:{type:"primary",icon:"ios-film-outline"},on:{click:e.handleAddProj}},[e._v("Add a new config project")]),r("Poptip",{attrs:{confirm:"",title:"Confirm to delete this project"},on:{"on-ok":e.handleDelProj}},[r("Button",{staticStyle:{"margin-bottom":"2px"},attrs:{type:"error",icon:"ios-film-outline"}},[e._v("Delete current config project")])],1),e.projects.length?[r("Select",{staticStyle:{width:"260px"},attrs:{multiple:"",filterable:!0},on:{"on-change":e.filterProject},model:{value:e.projectSelect,callback:function(t){e.projectSelect=t},expression:"projectSelect"}},e._l(e.projects,(function(t){return r("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1),r("Tabs",{attrs:{type:"line"},model:{value:e.activePro,callback:function(t){e.activePro=t},expression:"activePro"}},[e._l(e.showProjects,(function(t){return[r("TabPane",{attrs:{label:t,icon:"logo-apple",name:t}},[e.activePro==t?r("conf-perm",{attrs:{proj:e.activePro}}):e._e()],1)]}))],2)]:[r("Alert",{attrs:{type:"warning"}},[e._v("You don't have any Write permission on any projects  ")])]],2)],1)],1)],1)},s=[],o=r("e069"),n=r("0ad7"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("Row",[r("Col",{attrs:{span:"12"}},[r("label",[e._v("Reader group ")]),r("Transfer",{attrs:{filterable:"",data:e.allUsers,"target-keys":e.targetReader,"render-format":e.renderFormat},on:{"on-change":e.handleReaderTransfer}}),r("div",{staticStyle:{"margin-top":"10px"}},[r("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSave("read")}}},[e._v("Save")]),r("Button",{on:{click:function(t){return e.handleReset("read")}}},[e._v(" Reset")])],1)],1),r("Col",{attrs:{span:"12"}},[r("label",[e._v("Writer group ")]),r("Transfer",{attrs:{filterable:"",data:e.allUsers,"target-keys":e.targetWriter,"render-format":e.renderFormat},on:{"on-change":e.handleWriterTransfer}}),r("div",{staticStyle:{"margin-top":"10px"}},[r("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSave("write")}}},[e._v("Save")]),r("Button",{on:{click:function(t){return e.handleReset("write")}}},[e._v(" Reset")])],1)],1)],1)],1)},c=[],l={name:"ConfPerm",data(){return{projects:[],activePro:"",targetReader:[],orgReader:[],targetWriter:[],orgWriter:[]}},components:{},props:["proj"],created(){this.loadPerm()},computed:{allUsers(){let e=[];return this.$store.state.user.allUsers.forEach(t=>{let r={};r.key=t.username,r.value=t.first_name+" "+t.last_name,e.push(r)}),e}},methods:{loadPerm(){o["LoadingBar"].start(),Object(n["f"])(this.proj).then(e=>{const t=e.data;200===e.status?(this.targetReader=t.reader,this.orgReader=t.reader,this.targetWriter=t.writer,this.orgWriter=t.writer):(o["Message"].error(null==t.message?"Load permission failed":t.message),o["LoadingBar"].error()),o["LoadingBar"].finish()}).catch(e=>{o["Message"].error(e.response.status),console.log(e.response.data)})},renderFormat(e){return e.value},handleReaderTransfer(e){this.targetReader=e},handleWriterTransfer(e){this.targetWriter=e},handleSave(e){o["LoadingBar"].start();let t={proj:this.proj,perm:e,users:"read"===e?this.targetReader:this.targetWriter};Object(n["h"])(t).then(e=>{const t=e.data;200===e.status?o["Message"].success(t.message):(o["Message"].error(null==t.message?"Update project perm failed":t.message),o["LoadingBar"].error()),o["LoadingBar"].finish()}).catch(e=>{o["Message"].error(e.response.status),console.log(e.response.data)})},handleReset(e){"read"===e?this.targetReader=this.orgReader:this.targetWriter=this.orgWriter}}},d=l,p=r("2877"),h=Object(p["a"])(d,i,c,!1,null,null,null),u=h.exports,g=r("2f62"),f={name:"ConfCenterManage",data(){return{projects:[],projectSelect:[],activePro:"",newProj:""}},components:{ConfPerm:u},created(){this.loadProject(),this.getAllUsers()},computed:{refresh(){return null!=this.projects},showProjects(){return this.projectSelect.length<=0?this.projects:this.projectSelect}},methods:{...Object(g["b"])(["getAllUsers"]),loadProject(){o["LoadingBar"].start(),this.loading=!0,Object(n["g"])().then(e=>{const t=e.data;200===e.status?(this.projects=t.data,this.activePro=this.projects[0]):o["Message"].error(t.message),o["LoadingBar"].finish(),this.loading=!1}).catch(e=>{o["Message"].error(e.response.status),o["LoadingBar"].error(),this.loading=!1})},handleAddProj(){this.$Modal.confirm({title:'<div style="padding-bottom:5px">Project name</div>',render:e=>e("Input",{props:{value:this.newProj,autofocus:!0,placeholder:"Please enter your name..."},on:{input:e=>{this.newProj=e}}}),onOk:()=>{""==this.newProj?this.$Message.warning("project name should not be empty"):(o["LoadingBar"].start(),Object(n["b"])(this.newProj.trim()).then(e=>{const t=e.data;200===e.status?(o["Message"].success(t.message),this.projects.push(this.newProj.trim())):o["Message"].error(null==t.message?"Add project failed":t.message),o["LoadingBar"].finish()}).catch(e=>{o["Message"].error(e),o["LoadingBar"].error()}))},onCancel:()=>{this.newProj=""}})},handleDelProj(){let e={proj:this.activePro};Object(n["d"])(e).then(e=>{const t=e.data;if(200===e.status){let e=this.projects.indexOf(this.activePro);this.projects.splice(e,1),this.activePro=this.projects[0]}else o["Message"].error(null==t.message?"Delete project failed":t.message)}).catch(e=>{o["Message"].error(e.response.status),console.log(e.response.data)})},filterProject(){this.projectSelect.length>0?(this.activePro=null,this.$nextTick(()=>{this.activePro=this.projectSelect[this.projectSelect.length-1]})):(this.activePro=null,this.$nextTick(()=>{this.activePro=this.projects[0]}))}}},m=f,j=Object(p["a"])(m,a,s,!1,null,null,null);t["default"]=j.exports}}]);